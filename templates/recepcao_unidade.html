{% extends "base.html" %}

{% block content %}
<div class="container main-content">
    <div class="page-header">
        <h2>Cadastro de Pedido de Exame</h2>
        <p>Preencha os dados necessários para registrar o pedido físico no sistema de regulação.</p>
    </div>

    <div class="form-container">
        <form method="POST" class="task-form" id="form-recepcao">
            
            <!-- Unidade solicitante -->
            <div class="form-group">
                <label for="unidade">Unidade solicitante:</label>
                <select id="unidade" name="unidade" class="form-control" required>
                    <option value="">Selecione a unidade...</option>
                    {% for u in unidades %}
                    <option value="{{ u.id }}">{{ u.nome }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Nome do paciente -->
            <div class="form-group">
                <label for="nome_paciente">Nome do Paciente:</label>
                <input type="text" id="nome_paciente" name="nome_paciente" class="form-control"
                       placeholder="Digite o nome do paciente">
            </div>

            <!-- Exame -->
            <div class="form-group">
                <label for="exame">Exame:</label>
                <select id="exame" name="exame" class="form-control" required>
                    <option value="">Selecione o exame...</option>
                    {% for e in exames %}
                    <option value="{{ e.id }}" data-altura="{{ e.exige_altura }}" data-peso="{{ e.exige_peso }}">
                        {{ e.nome }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Prioridade -->
            <div class="form-group">
                <label for="prioridade">Prioridade:</label>
                <select id="prioridade" name="prioridade" class="form-control" required>
                    <option value="P1">P1 - Urgente</option>
                    <option value="P2">P2 - Estável</option>
                </select>
            </div>

            <!-- Dependências -->
            <div id="dependencias" style="display:none;">
                <div class="form-group">
                    <label for="altura">Altura (cm):</label>
                    <input type="number" step="0.01" name="altura" id="altura" class="form-control" placeholder="Ex: 170">
                </div>

                <div class="form-group">
                    <label for="peso">Peso (kg):</label>
                    <input type="number" step="0.01" name="peso" id="peso" class="form-control" placeholder="Ex: 70.5">
                </div>
            </div>

            <!-- Observações -->
            <div class="form-group">
                <label for="observacoes">Observações:</label>
                <textarea id="observacoes" name="observacoes" rows="4" class="form-control"
                          placeholder="Ex: informações adicionais ou observações do profissional..."></textarea>
            </div>

            <!-- Anexo (opcional) -->
            <div class="form-group">
                <label for="anexo">Anexo (opcional):</label>
                <input type="file" id="anexo" name="anexo" accept="application/pdf" class="form-control-file">
                <small class="form-text text-muted">Anexe exames anteriores (opcional). Apenas arquivos .pdf são aceitos.</small>
            </div>

            <!-- Botões -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Registrar Pedido</button>
                <a href="/" class="btn btn-secondary">Cancelar</a>
            </div>
        </form>
    </div>
</div>

<!-- ==================== MODAL DE SUCESSO ==================== -->
<div id="modalSucesso" class="modal">
    <div class="modal-conteudo">
        <h3>✅ Pedido registrado com sucesso!</h3>
        <p id="textoProtocolo">O protocolo do pedido foi gerado e está disponível no sistema.</p>
        <p id="linkAnexo" style="display:none;"></p>
        <div class="modal-botoes">
            <button id="btnNovo" class="btn-confirmar">Registrar outro</button>
            <button id="btnFechar" class="btn-cancelar">Fechar</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/recepcao.js') }}"></script>
{% endblock %}